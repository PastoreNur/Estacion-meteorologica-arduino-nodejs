


<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>
  Estación Meteorológica
  </title>
  <!--     los inconos y fuentes    -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <!-- nucleo inocos -->
  <link href="css/nucleo-icons.css" rel="stylesheet" />
  <!-- Carga de CSS-->
  <link href="css/black-dashboard.css?v=1.0.0" rel="stylesheet" />
 
  <link href="esta_meteo/estacionmete.css" rel="stylesheet" />
  
  
</head>

<body class="">
  <div class="wrapper">
    <div class="sidebar">
      <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red"
    -->
      <div class="sidebar-wrapper">
        <div class="logo">
        
          <a href="/" class="simple-text logo-normal">
            Tiempo Real
          </a>
        </div>
        <ul class="nav">

          <li>
            <a href="humedad.html">
              <i class="tim-icons icon-alert-circle-exc"></i>
              <p>Humedad</p>
            </a>
          </li>
          <li>
            <a href="temperatura.html">
          <i class="tim-icons icon-cloud-download-93"></i>
              <p>Temperatura</p>
            </a>
          </li>
          <li>
            <a href="presionatmosferica.html">
              <i class="tim-icons icon-world"></i>
              <p>Presion Atmosférica</p>
            </a>
          </li>
          <li>
            <a href="intensidadluminica.html">
              <i class="tim-icons icon-bulb-63"></i>
              <p>Intensidad Lumínica</p>
            </a>
          </li>
          <li>
            <a href="viento.html">
              <i class="tim-icons icon-send"></i>
              <p>Viento</p>
            </a>
          </li>
         
        </ul>
      </div>
    </div>






     <!-- PANEL PEINCIPAL -->

    <div class="main-panel">
     
      <nav class="navbar navbar-expand-lg navbar-absolute navbar-transparent">
        <div class="container-fluid">
          <div class="navbar-wrapper">
          <div class="collapse navbar-collapse" id="navigation">
          </div>
        </div>
      </nav>

      
      <!-- End Navbar -->
      <div class="content">
        <div class="row">
          <div class="col-12">
            <div class="card card-chart">
              <div class="card-header ">


                
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="chartBig1"></canvas>
                </div>
              </div>
            </div>
          </div>
          
        </div>


        
        <div class="row">

          
          <div class="col-lg-12">
            <div class="card card-chart">

              
              <div class="card-header">
                <h5 class="card-category">Resultados</h5>
                <h3 class="card-title"><i class="tim-icons icon-bell-55 text-primary"></i> Intensidad Luminosa</h3>
              </div>


              <div class="card-body">
                <div class="chart-area">
                  <canvas id="luminosaBarras"></canvas>
                </div>
              </div>
            </div>
          </div>



          <div class="col-lg-12">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-category">Expresado en</h5>
                <h3 class="card-title"><i class="tim-icons icon-delivery-fast text-info"></i>Intensidad Luminosa</h3>
              </div>
              
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="linealluminosa"></canvas>
                </div>
              </div>
            </div>
          </div>




          <div class="col-lg-12">
            <div id="rangoluminoso"  style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 50%">
              <i class="fa fa-calendar"></i>&nbsp;
              <span></span> <i class="fa fa-caret-down"></i>
           </div>

            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-category">Rango de fechas</h5>
                <h3 class="card-title"><i class="tim-icons icon-send text-success"></i>Rango de Intensidad Luminosa</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="luminosodate"></canvas>
                </div>
              </div>
            </div>
            
          </div>

          
        </div>
      </div>








      <footer class="footer">
        <div class="container-fluid">
          <ul class="nav">
            <li class="nav-item">
              <a href="javascript:void(0)" class="nav-link">
                Estación Meteorológica
              </a>
            </li>
           
          </ul>
          <div class="copyright">
            ©
            <script>

              //Script toma las fechas en años actuales
              
              document.write(new Date().getFullYear())
            </script>
            <a href="javascript:void(0)" target="">Microprogramacion</a> 
          </div>
        </div>
      </footer>
    </div>
  </div>


    <!--FIN PANEL PRINCIPAL-->

  
 




  <!--   Core JS Files   -->
  <script src="js/core/jquery.min.js"></script>
  <script src="js/core/popper.min.js"></script>
  <script src="js/core/bootstrap.min.js"></script>
  <script src="js/libreria/perfect-scrollbar.jquery.min.js"></script>
 
  <!-- PARA QUE CARGUE LA ONDA DE LOS Chart JS -->
  <script src="js/libreria/chartjs.min.js"></script>
  
  <!-- CONTROLA EL COLOR NEGRO DEL DASHBOARD, ESTO ES EL SCRIPT PARA CAMBIAR DE COLOR -->
  <script src="js/black-dashboard.min.js?v=1.0.0"></script>
  <script src="esta_meteo/estacionmete.js"></script>
  <script src="https://cdn.trackjs.com/agent/v3/latest/t.js"></script>
  <script src="/socket.io/socket.io.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>

    <!-- CALL DEL DATEPICKER-->
  
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
   
  
  
  <script>

    // Make a request for a user with a given ID
  
    // Make a request for a user with a given ID
    axios.get('http://localhost:3000/registro')
  .then(function (response) {
    // handle success
    let result= response.data
    console.log(result);
    
    //grafica de barras de viento
  var ctx = document.getElementById('luminosaBarras').getContext('2d');
  var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'bar',
    
    // The data for our dataset
    data: {
        labels: [],
        datasets: [{
            label:  result[0].time.Dia + 5 + "/"+result[0].time.Mes + "/"+result[0].time.anio,
            backgroundColor: 'rgb(255, 0, 0)',
            borderColor: 'rgb(41, 108, 105)',
            data: [result[0].luz],
            fill:true,
        },{
            label: result[1].time.Dia + 4 +"/"+result[1].time.Mes + "/"+result[1].time.anio,
            backgroundColor: 'rgb(0, 128, 128))',
            borderColor: 'rgb(41, 128, 185)',
            data: [result[1].luz],
            fill: true,
        },{
            label: result[2].time.Dia +3 + "/"+result[2].time.Mes + "/"+result[2].time.anio,
            backgroundColor: 'rgb(0, 0, 128)',
            borderColor: 'rgb(41, 128, 185)',
            data: [result[2].luz],
            fill: true,
        },{
            label: result[3].time.Dia + 2 + "/"+result[3].time.Mes + "/"+result[3].time.anio,
            backgroundColor: 'rgb(52, 73, 94)',
            borderColor: 'rgb(41, 128, 185)',
            data: [result[3].luz],
            fill: true,
        },{
            label: result[4].time.Dia + 1 + "/"+result[4].time.Mes + "/"+result[4].time.anio,
            backgroundColor: 'rgb(128, 0, 0)',
            borderColor: 'rgb(41, 128, 185)',
            data: [result[4].luz],
            fill: true,
        }
      ]
    },

    // Configuration options go here
    options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
});
//termina grafica de barras de viento
  
  })
  .catch(function (error) {
    // handle error
    console.log(error);
    return null
  });
  
  axios.get('http://localhost:3000/registrohora')
    .then(function (response) {
    // handle success
    let result= response.data
    console.log(result);
  //GRAFICA LINEAL 3 DE HUMEDAD
   var ctx1 = document.getElementById('linealluminosa').getContext('2d');
   var chart1 = new Chart(ctx1, {
    // The type of chart we want to create
    type: 'line',

    // The data for our dataset
    data: {
        labels: ["Horas"],
        datasets: [{
            label: "",
            backgroundColor: 'rgb(128, 0, 0)',
            borderColor: 'rgb(41, 108, 105)',
            data: [0],
            fill:true,
        }
      ]
    },
    // Configuration options go here
    options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
    });
  //termina grafica lineal humedad

//AQUÍ EL SCRIPT DEL DATE PICKER**************


$(function() {

var start = moment().subtract(29, 'days');
var end = moment();

function cb(start, end) {
    $('#rangoluminoso span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
}

$('#rangoluminoso').daterangepicker({
    startDate: start,
    endDate: end,
    ranges: {
       'Hoy': [moment(), moment()],
       'Ayer': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
       'Hace 7 días': [moment().subtract(6, 'days'), moment()],
       'Últimos 30 días': [moment().subtract(29, 'days'), moment()],
       'Este mes': [moment().startOf('month'), moment().endOf('month')],
       'Mes pasado': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
    }
}, cb);

cb(start, end);

});



//FIN DEL DATEPICKER**************************
//GRAFICA DEL DATEPICKER

var ctx1 = document.getElementById('luminosodate').getContext('2d');
   var chart1 = new Chart(ctx1, {
    // The type of chart we want to create
    type: 'line',

    // The data for our dataset
    data: {
        labels: ["Horas"],
        datasets: [{
            label: "",
            backgroundColor: 'rgb(128, 0, 0)',
            borderColor: 'rgb(41, 108, 105)',
            data: [0],
            fill:true,
        }
      ]
    },
       // Configuration options go here
       options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
    });
 

//FIN DE LA GRAFICA DEL DATEPICKER







    chart1.data.datasets[0].data.push(0)
    counter = 1
    result.reverse().forEach(element => {
      console.log(chart1.data.labels);
      if (element.humedad == null) {
        chart1.data.datasets[0].data.push(0)
      }else{
        chart1.data.datasets[0].data.push(element.luz)
      }
      
      chart1.data.labels.push(element.time.hora+counter)
      counter++
      
    });
    chart1.update()
  //termina grafica de barras de viento
  
  })
  .catch(function (error) {
    // handle error
    console.log(error);
    return null
  });

  const socket = io();
  var ctxs = document.getElementById('chartBig1').getContext('2d');
  var charts = new Chart(ctxs, {
    // The type of chart we want to create
    type: 'line',
    // The data for our dataset
    data: {
        labels: ["Segundos"],
        datasets: [{
            label: "Intensidad luminosa",
            backgroundColor: 'rgb(52, 73, 94)',
            borderColor: 'rgb(41, 128, 185)',
            data: [0],
            fill: true,
        }
      ]
    },

    // Configuration options go here
    options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
  });


//grafica de barras de luminica 
var ctx = document.getElementById('luminosaBarras').getContext('2d');
  var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'bar',

    // The data for our dataset
    data: {
        labels: ["Segundos"],
        datasets: [{
            label: "Dato1",
            backgroundColor: 'rgb(255, 0, 0)',
            borderColor: 'rgb(41, 108, 185)',
            data: [],
            fill:true,
        },{
            label: "Dato2",
            backgroundColor: 'rgb(0, 128, 128))',
            borderColor: 'rgb(41, 128, 185)',
            data: [],
            fill: true,
        },{
            label: "Dato3",
            backgroundColor: 'rgb(0, 0, 128)',
            borderColor: 'rgb(41, 128, 185)',
            data: [],
            fill: true,
        },{
            label: "Dato5",
            backgroundColor: 'rgb(52, 73, 94)',
            borderColor: 'rgb(41, 128, 185)',
            data: [],
            fill: true,
        },{
            label: "Dato6",
            backgroundColor: 'rgb(128, 0, 0)',
            borderColor: 'rgb(41, 128, 185)',
            data: [],
            fill: true,
        }
      ]
    },

    // Configuration options go here
    options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
});
//termina grafica de barras de luminica

//GRAFICA LINEAL 3 DE VIWNTO
var ctx = document.getElementById('linealluminosa').getContext('2d');
  var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'line',

    // The data for our dataset
    data: {
        labels: ["Segundos"],
        datasets: [{
            label: "Dato1",
            backgroundColor: 'rgb(128, 0, 0)',
            borderColor: 'rgb(41, 108, 105)',
            data: [],
            fill:true,
        }
      ]
    },

    // Configuration options go here
    options: { 
        legend: {
            labels: {
                fontColor: "white",
               
            }
        },
        scales: {
            yAxes: [{
                ticks: {
                    fontColor: "white",
                    
                }
            }],
            xAxes: [{
                ticks: {
                    fontColor: "white",
                  
                }
            }]
        }
    }
});
//termina grafica lineal luminosa

  let counter = 0 ;
  socket.on('arduino:data', function (dataSerial) {
   console.log(dataSerial);
    charts.data.labels.push(dataSerial.value.time.hora + ':' + dataSerial.value.time.minutos + ':' + dataSerial.value.time.segundos);
    charts.data.datasets.forEach(dataset => {
   dataset.data.push(dataSerial.value.luz)
  });
    counter++;
    charts.update();
  });
    $(document).ready(function() {
    $().ready(function() {
      $sidebar = $('.sidebar');
      $navbar = $('.navbar');
      $main_panel = $('.main-panel');

      $full_page = $('.full-page');

      $sidebar_responsive = $('body > .navbar-collapse');
      sidebar_mini_active = true;
      white_color = false;

      window_width = $(window).width();

      fixed_plugin_open = $('.sidebar .sidebar-wrapper .nav li.active a p').html();



      $('.fixed-plugin a').click(function(event) {
        if ($(this).hasClass('switch-trigger')) {
          if (event.stopPropagation) {
            event.stopPropagation();
          } else if (window.event) {
            window.event.cancelBubble = true;
          }
        }
      });

      $('.fixed-plugin .background-color span').click(function() {
        $(this).siblings().removeClass('active');
        $(this).addClass('active');

        var new_color = $(this).data('color');

        if ($sidebar.length != 0) {
          $sidebar.attr('data', new_color);
        }

        if ($main_panel.length != 0) {
          $main_panel.attr('data', new_color);
        }

        if ($full_page.length != 0) {
          $full_page.attr('filter-color', new_color);
        }

        if ($sidebar_responsive.length != 0) {
          $sidebar_responsive.attr('data', new_color);
        }
      });

      $('.switch-sidebar-mini input').on("switchChange.bootstrapSwitch", function() {
        var $btn = $(this);

        if (sidebar_mini_active == true) {
          $('body').removeClass('sidebar-mini');
          sidebar_mini_active = false;
          blackDashboard.showSidebarMessage('Sidebar mini deactivated...');
        } else {
          $('body').addClass('sidebar-mini');
          sidebar_mini_active = true;
          blackDashboard.showSidebarMessage('Sidebar mini activated...');
        }

        // we simulate the window Resize so the charts will get updated in realtime.
        var simulateWindowResize = setInterval(function() {
          window.dispatchEvent(new Event('resize'));
        }, 180);

        // we stop the simulation of Window Resize after the animations are completed
        setTimeout(function() {
          clearInterval(simulateWindowResize);
        }, 1000);
      });

      $('.switch-change-color input').on("switchChange.bootstrapSwitch", function() {
        var $btn = $(this);

        if (white_color == true) {

          $('body').addClass('change-background');
          setTimeout(function() {
            $('body').removeClass('change-background');
            $('body').removeClass('white-content');
          }, 900);
          white_color = false;
        } else {

          $('body').addClass('change-background');
          setTimeout(function() {
            $('body').removeClass('change-background');
            $('body').addClass('white-content');
          }, 900);

          white_color = true;
        }


      });

      $('.light-badge').click(function() {
        $('body').addClass('white-content');
      });

      $('.dark-badge').click(function() {
        $('body').removeClass('white-content');
      });
    });
  });
  $(document).ready(function() {
    // Javascript method's body can be found in recursos/js/demos.js
    demo.initDashboardPageCharts();

  });
  </script>

</body>

</html>